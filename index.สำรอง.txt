<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 7</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- AOS Animation CSS -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

  <!-- SweetAlert2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', 'Kanit', sans-serif;
    }

    .navbar-brand {
      font-weight: 600;
    }

    .login-container,
    .search-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 30px;
      background-color: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      margin-top: 30px;
    }

    .user-info {
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .search-form {
      background-color: #f8f9fa;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
      border: 1px solid #e9ecef;
    }

    .search-form h5 {
      color: #495057;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #dee2e6;
    }

    .form-label {
      font-weight: 600;
      color: #495057;
    }

    .search-input-group {
      position: relative;
    }

    .search-icon {
      position: absolute;
      top: 12px;
      left: 15px;
      color: #6c757d;
    }

    .search-input {
      padding-left: 45px;
      border-radius: 8px;
      height: 45px;
    }

    .search-btn-group {
      margin-top: 20px;
      text-align: center;
    }

    .search-btn {
      border-radius: 8px;
      padding: 10px 25px;
      margin: 0 5px;
      min-width: 120px;
    }

    .result-card {
      border-left: 5px solid #0d6efd;
      border-radius: 10px;
      margin-bottom: 15px;
      transition: transform 0.3s ease;
    }

    .result-card:hover {
      transform: translateY(-5px);
    }

    .result-header {
      background-color: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      padding: 10px 15px;
      border-radius: 10px 10px 0 0;
      font-weight: 600;
    }

    .result-body {
      padding: 15px;
    }

    .data-label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 5px;
    }

    .data-value {
      color: #212529;
      margin-bottom: 10px;
    }

    .no-results {
      text-align: center;
      padding: 40px 20px;
      color: #6c757d;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      color: #6c757d;
      font-size: 0.9rem;
    }

    .loading-spinner {
      display: none;
      text-align: center;
      padding: 30px;
    }

    .logo {
      font-weight: 700;
      color: #0d6efd;
      font-size: 1.5rem;
    }

    .data-stats {
      background-color: #e9ecef;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .error-info {
      background-color: #fff3cd;
      border: 1px solid #ffc107;
      color: #856404;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {

      .login-container,
      .search-container {
        padding: 20px;
        margin-top: 20px;
      }

      .search-form {
        padding: 15px;
      }

      .search-btn {
        margin-bottom: 10px;
        width: 100%;
      }
    }

    .table-responsive {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .table {
      margin-bottom: 0;
    }

    .table thead th {
      background-color: #0d6efd;
      color: white;
      border-bottom: 2px solid #dee2e6;
      font-weight: 600;
      padding: 12px 8px;
    }

    .table tbody tr {
      transition: background-color 0.2s ease;
    }

    .table tbody tr:hover {
      background-color: rgba(13, 110, 253, 0.05);
    }

    .table tbody td {
      padding: 10px 8px;
      vertical-align: middle;
    }

    .table tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    .table tbody tr:nth-child(even):hover {
      background-color: rgba(13, 110, 253, 0.05);
    }

    /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å */
    @media (max-width: 768px) {
      .table-responsive {
        font-size: 0.9rem;
      }

      .table thead th,
      .table tbody td {
        padding: 8px 6px;
      }
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å */
    .copy-row-btn {
      padding: 4px 8px;
      transition: all 0.2s ease;
    }

    .copy-row-btn:hover {
      background-color: #0d6efd;
      color: white;
      transform: scale(1.05);
    }

    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à */
    @keyframes copySuccess {
      0% {
        background-color: #d4edda;
      }

      100% {
        background-color: transparent;
      }
    }

    .copy-success {
      animation: copySuccess 1s ease;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    .btn-success {
      background-color: #198754;
      border-color: #198754;
    }

    .btn-success:hover {
      background-color: #157347;
      border-color: #146c43;
    }

    /* ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Log */
    .log-container {
      margin-top: 30px;
      padding: 20px;
      background-color: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    .log-item {
      padding: 10px 0;
      border-bottom: 1px solid #f5f5f5;
    }

    .log-item:last-child {
      border-bottom: none;
    }

    .log-time {
      font-size: 0.85rem;
      color: #6c757d;
    }

    .log-user {
      font-weight: 600;
      color: #495057;
    }

    .log-action {
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .log-in {
      background-color: #d1e7dd;
      color: #0f5132;
    }

    .log-out {
      background-color: #f8d7da;
      color: #842029;
    }

    .log-system {
      background-color: #cfe2ff;
      color: #084298;
    }

    /* Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á Log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    .log-modal .modal-content {
      border-radius: 15px;
    }

    .log-modal .modal-header {
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      color: white;
      border-radius: 15px 15px 0 0;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .table-responsive {
        font-size: 0.85rem;
      }

      .copy-row-btn {
        padding: 3px 6px;
      }

      .copy-row-btn svg {
        width: 14px;
        height: 14px;
      }

      .log-container {
        padding: 15px;
      }
    }

    /* Quick Search Toggle */
    .quick-search-toggle {
      cursor: pointer;
      color: #0d6efd;
      font-size: 0.9rem;
      margin-bottom: 15px;
      display: inline-block;
    }

    .quick-search-toggle:hover {
      text-decoration: underline;
    }

    .navbar-brand img {
      width: 48px;
      height: 48px;
    }
    .login-container img {
      border-radius: 100%;
      width: 40%;
      height: 40%;
    }
  </style>
</head>

<body>
  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center logo" href="#">
        <img src="https://i.ibb.co/HD1ZZsWy/Population-search-system-Logo.png"
          alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 7" width="40" height="40" class="me-2">
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 7
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <div id="userProfile" class="d-none">
              <div class="d-flex align-items-center">
                <img id="userPhoto" class="rounded-circle me-2" width="35" height="35" src="" alt="User Photo">
                <span id="userName" class="nav-link text-dark p-0"></span>
                <button id="logoutBtn" class="btn btn-outline-danger btn-sm ms-3">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Login Section (Shown when not logged in) -->
  <div id="loginSection" class="container">
    <div class="login-container" data-aos="fade-up">
      <div class="text-center mb-4">
        <img src="https://i.ibb.co/HD1ZZsWy/Population-search-system-Logo.png"
          alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 7" width="120" class="mb-3">
        <h2 class="mb-3">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 7</h2>
        <p class="text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google Account ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö</p>
      </div>


      <div class="d-flex justify-content-center">
        <button id="googleLoginBtn" class="btn btn-lg btn-primary d-flex align-items-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-google me-2"
            viewBox="0 0 16 16">
            <path
              d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352 2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z" />
          </svg>
          ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google
        </button>
      </div>

      <div class="mt-4 text-center">
        <small class="text-muted">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!</small>
      </div>
    </div>
  </div>

  <!-- Search Section (Shown when logged in) -->
  <div id="searchSection" class="container d-none">
    <div class="search-container" data-aos="fade-up">
      <!-- User Info -->
      <div class="user-info">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="mb-1">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h5>
            <p class="mb-0" id="welcomeMessage"></p>
          </div>
          <img id="userPhotoLarge" class="rounded-circle" width="60" height="60" src="" alt="User Photo">
        </div>
      </div>

      <!-- Database Stats -->
      <div id="dbStats" class="data-stats d-none">
        <div class="row text-center">
          <div class="col-md-4">
            <h5 id="totalRecords">0</h5>
            <small class="text-muted">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small>
          </div>
          <div class="col-md-4">
            <h5 id="lastUpdated">-</h5>
            <small class="text-muted">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</small>
          </div>
          <div class="col-md-4">
            <h5 id="searchResultsCount">0</h5>
            <small class="text-muted">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</small>
          </div>
        </div>
      </div>

      <!-- Debug Info -->
      <div id="debugInfo" class="error-info d-none">
        <h6>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡∏ö‡∏±‡∏Å:</h6>
        <p id="debugMessage" class="mb-0 small"></p>
      </div>

      <!-- Quick Search Toggle -->
      <div class="text-end mb-2">
        <span id="quickSearchToggle" class="quick-search-toggle">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search me-1"
            viewBox="0 0 16 16">
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
          </svg>
          ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
        </span>
      </div>

      <!-- Advanced Search Form -->
      <div class="search-form" id="advancedSearchForm">
        <h5 class="text-center">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£</h5>
        <div class="row g-3">
          <div class="col-md-6">
            <label for="houseNumber" class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô</label>
            <div class="search-input-group">
              <div class="search-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-house-door" viewBox="0 0 16 16">
                  <path
                    d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z" />
                </svg>
              </div>
              <input type="text" class="form-control search-input" id="houseNumber" placeholder="‡πÄ‡∏ä‡πà‡∏ô: 123, 45/6">
            </div>
          </div>

          <div class="col-md-6">
            <label for="idCard" class="form-label">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
            <div class="search-input-group">
              <div class="search-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-person-badge" viewBox="0 0 16 16">
                  <path d="M6.5 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3zM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                  <path
                    d="M4.5 0A2.5 2.5 0 0 0 2 2.5V14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2.5A2.5 2.5 0 0 0 11.5 0h-7zM3 2.5A1.5 1.5 0 0 1 4.5 1h7A1.5 1.5 0 0 1 13 2.5v10.795a4.2 4.2 0 0 0-.776-.492C11.392 12.387 10.063 12 8 12s-3.392.387-4.224.803a4.2 4.2 0 0 0-.776.492V2.5z" />
                </svg>
              </div>
              <input type="text" class="form-control search-input" id="idCard" placeholder="‡πÄ‡∏ä‡πà‡∏ô: 1-2345-67891-01-1">
            </div>
          </div>

          <div class="col-md-6">
            <label for="firstName" class="form-label">‡∏ä‡∏∑‡πà‡∏≠</label>
            <div class="search-input-group">
              <div class="search-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person"
                  viewBox="0 0 16 16">
                  <path
                    d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z" />
                </svg>
              </div>
              <input type="text" class="form-control search-input" id="firstName" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏°‡∏ä‡∏≤‡∏¢, ‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á">
            </div>
          </div>

          <div class="col-md-6">
            <label for="lastName" class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <div class="search-input-group">
              <div class="search-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person"
                  viewBox="0 0 16 16">
                  <path
                    d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z" />
                </svg>
              </div>
              <input type="text" class="form-control search-input" id="lastName" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÉ‡∏à‡∏î‡∏µ, ‡∏™‡∏∏‡∏Ç‡πÉ‡∏à">
            </div>
          </div>

          <div class="col-12">
            <div class="search-btn-group">
              <button id="searchBtn" class="btn btn-primary search-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-search me-2" viewBox="0 0 16 16">
                  <path
                    d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg>
                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
              </button>
              <button id="clearBtn" class="btn btn-outline-secondary search-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-x-circle me-2" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                  <path
                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                </svg>
                ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              </button>
              <button id="showAllBtn" class="btn btn-outline-info search-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-list-ul me-2" viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                </svg>
                ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Search Box (Hidden by default) -->
      <div class="search-box d-none" id="quickSearchBox">
        <div class="search-input-group">
          <div class="search-icon">
            <svg xmlns="http://www.w3.org2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search"
              viewBox="0 0 16 16">
              <path
                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
            </svg>
          </div>
          <input type="text" id="quickSearchInput" class="form-control search-input"
            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô... (‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏°‡∏ä‡∏≤‡∏¢, 3-7005-00416-94-8)">
        </div>
        <div class="mt-3 text-center">
          <button id="quickSearchBtn" class="btn btn-primary search-btn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏î‡πà‡∏ß‡∏ô</button>
          <button id="showAdvancedBtn" class="btn btn-outline-primary search-btn ms-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
        </div>
      </div>

      <!-- Loading Spinner -->
      <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
        </div>
        <p class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
      </div>

      <!-- Search Results -->
      <div id="searchResults"></div>
    </div>

    <!-- Log Section -->
    <div class="log-container" data-aos="fade-up">
      <div class="log-header">
        <h5 class="mb-0">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h5>
        <button id="viewAllLogsBtn" class="btn btn-outline-primary btn-sm">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>

      <div id="recentLogs">
        <!-- Recent logs will be displayed here -->
        <div class="text-center text-muted py-3">
          <div class="spinner-border spinner-border-sm" role="status">
            <span class="visually-hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
          </div>
          <span class="ms-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="container">
      <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 7 &copy; 2023</p>
      <p class="small">‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!</p>
    </div>
  </div>

  <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á Log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
  <div class="modal fade log-modal" id="allLogsModal" tabindex="-1" aria-labelledby="allLogsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="allLogsModalLabel">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="allLogsContent">
            <!-- All logs will be displayed here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <!-- AOS JS -->
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

  <!-- Firebase and App Script -->
  <script>
    // ‡πÑ‡∏ü‡∏£‡πå‡πÄ‡∏ö‡∏™‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å
    const firebaseConfig = {
      apiKey: "AIzaSyDDOlnwzmujOPOlXUbWYrgK5YjnqI7hyrI",
      authDomain: "list-of-eligible-voters.firebaseapp.com",
      databaseURL: "https://list-of-eligible-voters-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "list-of-eligible-voters",
      storageBucket: "list-of-eligible-voters.firebasestorage.app",
      messagingSenderId: "307610806047",
      appId: "1:307610806047:web:d53aeafa11d62dd2ef722a"
    };

    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ AOS
    document.addEventListener('DOMContentLoaded', function () {
      AOS.init({
        duration: 800,
        once: true
      });
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
    let firebaseApp;
    let auth;
    let database;

    try {
      firebaseApp = firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      database = firebase.database();
      console.log("Firebase initialized successfully");
    } catch (error) {
      console.error("Firebase initialization error:", error);
      showFirebaseError(error);
    }

    // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á DOM elements
    const loginSection = document.getElementById('loginSection');
    const searchSection = document.getElementById('searchSection');
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userProfile = document.getElementById('userProfile');
    const userName = document.getElementById('userName');
    const userPhoto = document.getElementById('userPhoto');
    const userPhotoLarge = document.getElementById('userPhotoLarge');
    const welcomeMessage = document.getElementById('welcomeMessage');

    // Search elements
    const searchBtn = document.getElementById('searchBtn');
    const quickSearchBtn = document.getElementById('quickSearchBtn');
    const clearBtn = document.getElementById('clearBtn');
    const showAllBtn = document.getElementById('showAllBtn');
    const showAdvancedBtn = document.getElementById('showAdvancedBtn');
    const quickSearchToggle = document.getElementById('quickSearchToggle');

    // Search inputs
    const houseNumberInput = document.getElementById('houseNumber');
    const idCardInput = document.getElementById('idCard');
    const firstNameInput = document.getElementById('firstName');
    const lastNameInput = document.getElementById('lastName');
    const quickSearchInput = document.getElementById('quickSearchInput');

    // Search containers
    const advancedSearchForm = document.getElementById('advancedSearchForm');
    const quickSearchBox = document.getElementById('quickSearchBox');

    // Results elements
    const searchResults = document.getElementById('searchResults');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const dbStats = document.getElementById('dbStats');
    const totalRecords = document.getElementById('totalRecords');
    const lastUpdated = document.getElementById('lastUpdated');
    const searchResultsCount = document.getElementById('searchResultsCount');
    const debugInfo = document.getElementById('debugInfo');
    const debugMessage = document.getElementById('debugMessage');
    const recentLogs = document.getElementById('recentLogs');
    const viewAllLogsBtn = document.getElementById('viewAllLogsBtn');
    const allLogsModal = new bootstrap.Modal(document.getElementById('allLogsModal'));
    const allLogsContent = document.getElementById('allLogsContent');

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
    if (auth) {
      auth.onAuthStateChanged((user) => {
        if (user) {
          // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà
          showSearchSection(user);
          loadDatabaseStats();
          // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
          logUserAction(user, 'login');
          // ‡πÇ‡∏´‡∏•‡∏î Log ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
          loadRecentLogs();
          // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ realtime listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Log
          setupLogsListener();
        } else {
          // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
          showLoginSection();
        }
      });
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
    function showLoginSection() {
      loginSection.classList.remove('d-none');
      searchSection.classList.add('d-none');
      userProfile.classList.add('d-none');
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    function showSearchSection(user) {
      loginSection.classList.add('d-none');
      searchSection.classList.remove('d-none');
      userProfile.classList.remove('d-none');

      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      userName.textContent = user.displayName || user.email;
      welcomeMessage.textContent = `‡∏Ñ‡∏∏‡∏ì ${user.displayName || user.email}`;

      if (user.photoURL) {
        userPhoto.src = user.photoURL;
        userPhotoLarge.src = user.photoURL;
      } else {
        // ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        userPhoto.src = "https://ui-avatars.com/api/?name=" + encodeURIComponent(user.displayName || user.email) + "&background=0D8ABC&color=fff";
        userPhotoLarge.src = "https://ui-avatars.com/api/?name=" + encodeURIComponent(user.displayName || user.email) + "&background=0D8ABC&color=fff&size=60";
      }

      // ‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
      clearSearchFields();
      searchResults.innerHTML = '';
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î Firebase
    function showFirebaseError(error) {
      debugInfo.classList.remove('d-none');
      debugMessage.innerHTML = `
                <strong>‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:</strong> ${error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Firebase ‡πÑ‡∏î‡πâ'}<br>
                <strong>‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:</strong><br>
                1. ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (Rules) ‡πÉ‡∏ô Firebase Realtime Database<br>
                2. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï<br>
                3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏¥‡∏Å Firebase ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á<br>
                <strong>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô:</strong> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÉ‡∏ô Firebase Console
            `;
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    function loadDatabaseStats() {
      if (!database) {
        showDebugMessage("Database not initialized");
        return;
      }

      database.ref().once('value')
        .then((snapshot) => {
          const data = snapshot.val();
          if (data) {
            // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô records
            const recordCount = Object.keys(data).length;
            totalRecords.textContent = recordCount.toLocaleString();

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            const now = new Date();
            lastUpdated.textContent = now.toLocaleTimeString('th-TH');

            // ‡πÅ‡∏™‡∏î‡∏á statistics section
            dbStats.classList.remove('d-none');

            // ‡∏ã‡πà‡∏≠‡∏ô debug info ‡∏ñ‡πâ‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥
            debugInfo.classList.add('d-none');

            console.log("Database stats loaded successfully. Records found:", recordCount);
            showDebugMessage(`‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${recordCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`);
          } else {
            showDebugMessage("‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)");
          }
        })
        .catch((error) => {
          console.error('Error loading database stats:', error);
          showDebugMessage(`‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'}`);

          // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          debugInfo.classList.remove('d-none');
          debugMessage.innerHTML = `
                        <strong>‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong> ${error.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}<br>
                        <strong>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong><br>
                        1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Firebase Realtime Database ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Rules ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<br>
                        2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<br>
                    `;
        });
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ‡∏ö‡∏±‡∏Å
    function showDebugMessage(message) {
      console.log("Debug:", message);
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ‡∏•‡∏á Realtime Database
    function logUserAction(user, action) {
      if (!database) {
        console.error("Database not available for logging");
        return;
      }

      const timestamp = new Date().getTime();
      const date = new Date();
      const userEmail = user.email;
      const userName = user.displayName || user.email;
      const userId = user.uid;

      const logData = {
        userId: userId,
        userName: userName,
        userEmail: userEmail,
        action: action,
        timestamp: timestamp,
        date: date.toLocaleDateString('th-TH'),
        time: date.toLocaleTimeString('th-TH'),
        datetime: date.toLocaleString('th-TH')
      };

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase Realtime Database ‡∏ó‡∏µ‡πà path /system_logs
      database.ref('system_logs').push(logData)
        .then(() => {
          console.log(`‚úÖ Log recorded: ${userName} ${action} at ${date.toLocaleString('th-TH')}`);
        })
        .catch((error) => {
          console.error("‚ùå Error recording log:", error);
          // ‡∏ñ‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô local storage ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
          saveLogToLocalStorage(logData);
        });
    }

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ‡πÉ‡∏ô local storage ‡∏Å‡∏£‡∏ì‡∏µ Firebase ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    function saveLogToLocalStorage(logData) {
      try {
        let logs = JSON.parse(localStorage.getItem('pending_logs') || '[]');
        logs.push(logData);

        // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô logs ‡πÉ‡∏ô local storage
        if (logs.length > 100) {
          logs = logs.slice(-50);
        }

        localStorage.setItem('pending_logs', JSON.stringify(logs));
        console.log("üì¶ Log saved to localStorage temporarily");
      } catch (e) {
        console.error("Failed to save log to localStorage:", e);
      }
    }

    // ‡∏™‡πà‡∏á Log ‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏≤‡∏Å local storage ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Firebase
    function syncPendingLogs() {
      try {
        const pendingLogs = JSON.parse(localStorage.getItem('pending_logs') || '[]');

        if (pendingLogs.length > 0 && database) {
          console.log(`üîÑ Syncing ${pendingLogs.length} pending logs to Firebase`);

          pendingLogs.forEach(log => {
            database.ref('system_logs').push(log)
              .then(() => {
                console.log(`‚úÖ Synced pending log: ${log.userName} ${log.action}`);
              })
              .catch(error => {
                console.error("‚ùå Failed to sync log:", error);
              });
          });

          // ‡∏•‡∏ö logs ‡∏ó‡∏µ‡πà sync ‡πÅ‡∏•‡πâ‡∏ß
          localStorage.removeItem('pending_logs');
        }
      } catch (e) {
        console.error("Error syncing pending logs:", e);
      }
    }

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ realtime listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Log
    function setupLogsListener() {
      if (!database) return;

      // ‡∏•‡∏ö listener ‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
      if (window.logsListener) {
        database.ref('system_logs').off('value', window.logsListener);
      }

      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ listener ‡πÉ‡∏´‡∏°‡πà
      window.logsListener = database.ref('system_logs')
        .orderByChild('timestamp')
        .limitToLast(5)
        .on('value', (snapshot) => {
          const logs = [];
          snapshot.forEach((childSnapshot) => {
            const log = childSnapshot.val();
            log.id = childSnapshot.key;
            logs.push(log);
          });

          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
          logs.sort((a, b) => b.timestamp - a.timestamp);

          displayRecentLogs(logs);
        }, (error) => {
          console.error("Error in logs listener:", error);
          recentLogs.innerHTML = '<div class="text-center text-muted py-3">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ</div>';
        });
    }

    // ‡πÇ‡∏´‡∏•‡∏î Log ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
    function loadRecentLogs() {
      if (!database) {
        recentLogs.innerHTML = '<div class="text-center text-muted py-3">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ</div>';
        return;
      }

      // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° sync logs ‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà
      syncPendingLogs();

      database.ref('system_logs')
        .orderByChild('timestamp')
        .limitToLast(5)
        .once('value')
        .then((snapshot) => {
          const logs = [];
          snapshot.forEach((childSnapshot) => {
            const log = childSnapshot.val();
            log.id = childSnapshot.key;
            logs.push(log);
          });

          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
          logs.sort((a, b) => b.timestamp - a.timestamp);

          displayRecentLogs(logs);
        })
        .catch((error) => {
          console.error("Error loading logs:", error);

          // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å local storage ‡∏ñ‡πâ‡∏≤ Firebase ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
          loadLogsFromLocalStorage();
        });
    }

    // ‡πÇ‡∏´‡∏•‡∏î Log ‡∏à‡∏≤‡∏Å local storage
    function loadLogsFromLocalStorage() {
      try {
        const logs = JSON.parse(localStorage.getItem('pending_logs') || '[]');

        if (logs.length > 0) {
          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
          logs.sort((a, b) => b.timestamp - a.timestamp);

          // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
          const recentLogsList = logs.slice(0, 5);
          displayRecentLogs(recentLogsList);

          // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å local storage
          const info = document.createElement('div');
          info.className = 'alert alert-warning alert-sm mt-2';
          info.innerHTML = '<small>‚ö†Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (Firebase ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏õ‡∏Å‡∏ï‡∏¥)</small>';
          recentLogs.appendChild(info);
        } else {
          recentLogs.innerHTML = '<div class="text-center text-muted py-3">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>';
        }
      } catch (e) {
        console.error("Error loading logs from localStorage:", e);
        recentLogs.innerHTML = '<div class="text-center text-muted py-3">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ</div>';
      }
    }

    // ‡πÅ‡∏™‡∏î‡∏á Log ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    function displayRecentLogs(logs) {
      if (!logs || logs.length === 0) {
        recentLogs.innerHTML = '<div class="text-center text-muted py-3">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>';
        return;
      }

      let logsHTML = '';

      logs.forEach((log) => {
        const actionClass = log.action === 'login' ? 'log-in' : 'log-out';
        const actionText = log.action === 'login' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö';

        // ‡πÉ‡∏ä‡πâ datetime ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ format ‡πÉ‡∏´‡∏°‡πà
        const displayTime = log.datetime || formatTime(log.timestamp);

        logsHTML += `
          <div class="log-item">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <span class="log-user">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ : ${log.userName}</span>
                <span class="log-action ${actionClass} ms-2">${actionText}</span>
              </div>
              <div class="log-time">${displayTime}</div>
            </div>
          </div>
        `;
      });

      recentLogs.innerHTML = logsHTML;
    }

    // ‡πÇ‡∏´‡∏•‡∏î Log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    function loadAllLogs() {
      if (!database) {
        allLogsContent.innerHTML = '<div class="text-center text-muted py-5">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ</div>';
        return;
      }

      allLogsContent.innerHTML = `
        <div class="text-center py-3">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
          </div>
          <p class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...</p>
        </div>
      `;

      database.ref('system_logs')
        .orderByChild('timestamp')
        .once('value')
        .then((snapshot) => {
          const logs = [];
          snapshot.forEach((childSnapshot) => {
            const log = childSnapshot.val();
            log.id = childSnapshot.key;
            logs.push(log);
          });

          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤
          logs.sort((a, b) => b.timestamp - a.timestamp);

          displayAllLogs(logs);
        })
        .catch((error) => {
          console.error("Error loading all logs:", error);
          allLogsContent.innerHTML = '<div class="text-center text-muted py-5">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ</div>';
        });
    }

    // ‡πÅ‡∏™‡∏î‡∏á Log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    function displayAllLogs(logs) {
      if (!logs || logs.length === 0) {
        allLogsContent.innerHTML = '<div class="text-center text-muted py-5">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>';
        return;
      }

      let logsHTML = `
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th width="20%">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</th>
                <th width="20%">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
                <th width="10%">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</th>
                <th width="25%">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                <th width="25%">‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
              </tr>
            </thead>
            <tbody>
      `;

      logs.forEach((log) => {
        const actionClass = log.action === 'login' ? 'log-in' : 'log-out';
        const actionText = log.action === 'login' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö';

        // ‡πÉ‡∏ä‡πâ datetime ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ format ‡πÉ‡∏´‡∏°‡πà
        const displayTime = log.datetime || formatTime(log.timestamp);

        logsHTML += `
          <tr>
            <td>${displayTime}</td>
            <td><strong>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ : ${log.userName}</strong></td>
            <td><span class="log-action ${actionClass}">${actionText}</span></td>
            <td class="small">${log.userEmail}</td>
            <td class="small text-muted">${log.userId ? log.userId.substring(0, 8) + '...' : 'N/A'}</td>
          </tr>
        `;
      });

      logsHTML += `
            </tbody>
          </table>
        </div>
        <div class="mt-3 text-muted small">
          ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${logs.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        </div>
      `;

      allLogsContent.innerHTML = logsHTML;
    }

    // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
    function formatTime(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleString('th-TH');
    }

    // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    function clearSearchFields() {
      houseNumberInput.value = '';
      idCardInput.value = '';
      firstNameInput.value = '';
      lastNameInput.value = '';
      quickSearchInput.value = '';
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    function hasSearchCriteria() {
      return houseNumberInput.value.trim() !== '' ||
        idCardInput.value.trim() !== '' ||
        firstNameInput.value.trim() !== '' ||
        lastNameInput.value.trim() !== '' ||
        quickSearchInput.value.trim() !== '';
    }

    // ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google
    googleLoginBtn.addEventListener('click', () => {
      if (!auth) {
        Swal.fire({
          icon: 'error',
          title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Firebase Authentication ‡πÑ‡∏î‡πâ',
        });
        return;
      }

      const provider = new firebase.auth.GoogleAuthProvider();

      auth.signInWithPopup(provider)
        .then((result) => {
          // ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
          Swal.fire({
            icon: 'success',
            title: '‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            text: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠',
            timer: 2000,
            showConfirmButton: false
          });
        })
        .catch((error) => {
          // ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
          console.error("Google login error:", error);
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
            footer: error.message
          });
        });
    });

    // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    logoutBtn.addEventListener('click', () => {
      Swal.fire({
        title: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then((result) => {
        if (result.isConfirmed) {
          // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
          const user = auth.currentUser;
          if (user) {
            logUserAction(user, 'logout');
          }

          auth.signOut()
            .then(() => {
              Swal.fire({
                icon: 'success',
                title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                timer: 1500,
                showConfirmButton: false
              });
            })
            .catch((error) => {
              console.error("Logout error:", error);
            });
        }
      });
    });

    // ‡∏î‡∏π Log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    viewAllLogsBtn.addEventListener('click', () => {
      loadAllLogs();
      allLogsModal.show();
    });

    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    searchBtn.addEventListener('click', performAdvancedSearch);

    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏î‡πà‡∏ß‡∏ô
    quickSearchBtn.addEventListener('click', performQuickSearch);

    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Enter
    quickSearchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performQuickSearch();
      }
    });

    // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Enter ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
    firstNameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performAdvancedSearch();
      }
    });

    lastNameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performAdvancedSearch();
      }
    });

    houseNumberInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performAdvancedSearch();
      }
    });
    idCardInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performAdvancedSearch();
      }
    });

    // ‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    clearBtn.addEventListener('click', () => {
      clearSearchFields();
      searchResults.innerHTML = '';
      searchResultsCount.textContent = '0';
    });

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    showAllBtn.addEventListener('click', () => {
      clearSearchFields();
      showAllData();
    });

    // ‡∏™‡∏•‡∏±‡∏ö‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    quickSearchToggle.addEventListener('click', () => {
      if (advancedSearchForm.classList.contains('d-none')) {
        // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        advancedSearchForm.classList.remove('d-none');
        quickSearchBox.classList.add('d-none');
        quickSearchToggle.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search me-1" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
          </svg>
          ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
        `;
      } else {
        // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
        advancedSearchForm.classList.add('d-none');
        quickSearchBox.classList.remove('d-none');
        quickSearchToggle.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search me-1" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
          </svg>
          ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        `;
      }
    });

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    showAdvancedBtn.addEventListener('click', () => {
      advancedSearchForm.classList.remove('d-none');
      quickSearchBox.classList.add('d-none');
      quickSearchToggle.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search me-1" viewBox="0 0 16 16">
          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
        </svg>
        ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
      `;
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    function performAdvancedSearch() {
      const searchCriteria = {
        houseNumber: houseNumberInput.value.trim(),
        idCard: idCardInput.value.trim(),
        firstName: firstNameInput.value.trim(),
        lastName: lastNameInput.value.trim()
      };

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡πà‡∏≠‡∏á
      if (!Object.values(searchCriteria).some(value => value !== '')) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤',
          text: '‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡πà‡∏≠‡∏á',
        });
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á spinner ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
      loadingSpinner.style.display = 'block';
      searchResults.innerHTML = '';

      // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Realtime Database
      database.ref().once('value')
        .then((snapshot) => {
          // ‡∏ã‡πà‡∏≠‡∏ô spinner
          loadingSpinner.style.display = 'none';

          const data = snapshot.val();
          const results = [];

          if (!data) {
            // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            searchResults.innerHTML = `
          <div class="no-results" data-aos="fade-up">
            <h4 class="mt-3">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
            <p>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
          </div>
        `;
            searchResultsCount.textContent = '0';
            return;
          }

          // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
          Object.keys(data).forEach((key) => {
            const record = data[key];

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô object ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (record && typeof record === 'object') {
              let matches = true;

              // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
              if (searchCriteria.houseNumber) {
                const houseNumber = record['‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô'] || record['houseNumber'] || '';
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô string ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                const searchHouseNumber = String(searchCriteria.houseNumber).toLowerCase();
                const recordHouseNumber = String(houseNumber).toLowerCase();

                if (!recordHouseNumber.includes(searchHouseNumber)) {
                  matches = false;
                }
              }

              if (searchCriteria.idCard && matches) {
                const idCard = record['‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô'] || record['id'] || '';
                const searchIdCard = String(searchCriteria.idCard);
                if (!idCard.includes(searchIdCard)) {
                  matches = false;
                }
              }

              if (searchCriteria.firstName && matches) {
                const firstName = record['‡∏ä‡∏∑‡πà‡∏≠'] || record['name'] || '';
                const searchFirstName = String(searchCriteria.firstName).toLowerCase();
                const recordFirstName = String(firstName).toLowerCase();

                if (!recordFirstName.includes(searchFirstName)) {
                  matches = false;
                }
              }

              if (searchCriteria.lastName && matches) {
                const lastName = record['namaskul'] || record['‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || '';
                const searchLastName = String(searchCriteria.lastName).toLowerCase();
                const recordLastName = String(lastName).toLowerCase();

                if (!recordLastName.includes(searchLastName)) {
                  matches = false;
                }
              }

              if (matches) {
                results.push({
                  key: key,
                  ...record
                });
              }
            }
          });

          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
          searchResultsCount.textContent = results.length;

          // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
          displaySearchResults(results, '‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î');
        })
        .catch((error) => {
          // ‡∏ã‡πà‡∏≠‡∏ô spinner
          loadingSpinner.style.display = 'none';

          console.error("Search error:", error);

          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            html: `
          <div class="text-start">
            <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
            <p class="small text-muted"><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${error.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}</p>
          </div>
        `,
          });
        });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏î‡πà‡∏ß‡∏ô
    function performQuickSearch() {
      const searchTerm = quickSearchInput.value.trim();

      if (!searchTerm) {
        Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤',
          text: '‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡πâ‡∏≠‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏î‡πà‡∏ß‡∏ô',
        });
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á spinner ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î
      loadingSpinner.style.display = 'block';
      searchResults.innerHTML = '';

      // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Realtime Database
      database.ref().once('value')
        .then((snapshot) => {
          // ‡∏ã‡πà‡∏≠‡∏ô spinner
          loadingSpinner.style.display = 'none';

          const data = snapshot.val();
          const results = [];

          if (!data) {
            // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            searchResults.innerHTML = `
          <div class="no-results" data-aos="fade-up">
            <h4 class="mt-3">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
            <p>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
          </div>
        `;
            searchResultsCount.textContent = '0';
            return;
          }

          // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
          Object.keys(data).forEach((key) => {
            const record = data[key];

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô object ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (record && typeof record === 'object') {
              // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡πÑ‡∏°‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å-‡πÉ‡∏´‡∏ç‡πà)
              const searchLower = String(searchTerm).toLowerCase();

              // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              let found = false;

              // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å key ‡πÉ‡∏ô record
              for (const field in record) {
                if (record.hasOwnProperty(field)) {
                  const value = record[field];
                  // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô string ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                  const stringValue = String(value).toLowerCase();
                  if (stringValue.includes(searchLower)) {
                    found = true;
                    break;
                  }
                }
              }

              if (found) {
                results.push({
                  key: key,
                  ...record
                });
              }
            }
          });

          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
          searchResultsCount.textContent = results.length;

          // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
          displaySearchResults(results, searchTerm);
        })
        .catch((error) => {
          // ‡∏ã‡πà‡∏≠‡∏ô spinner
          loadingSpinner.style.display = 'none';

          console.error("Search error:", error);

          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            html: `
          <div class="text-start">
            <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
            <p class="small text-muted"><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${error.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}</p>
          </div>
        `,
          });
        });
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    function displaySearchResults(results, searchTerm) {
      searchResults.innerHTML = '';

      if (results.length === 0) {
        // ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        searchResults.innerHTML = `
          <div class="no-results" data-aos="fade-up">
            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="#6c757d" class="bi bi-search" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
            <h4 class="mt-3">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h4>
            <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö "${searchTerm}"</p>
            <p class="small text-muted">‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          </div>
        `;
        return;
      }

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏´‡∏≤‡∏Å‡∏°‡∏µ)
      results.sort((a, b) => {
        const orderA = parseInt(a['‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || a['proportion'] || a['‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || '0');
        const orderB = parseInt(b['‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || b['proportion'] || b['‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || '0');
        return orderA - orderB;
      });

      // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
      const resultsCount = document.createElement('div');
      resultsCount.className = 'mb-3';
      resultsCount.innerHTML = `<h5>‡∏û‡∏ö ${results.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ "${searchTerm}"</h5>`;
      searchResults.appendChild(resultsCount);

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      const copyAllButton = document.createElement('button');
      copyAllButton.className = 'btn btn-success btn-sm mb-3';
      copyAllButton.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check me-1" viewBox="0 0 16 16">
          <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
          <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
          <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
        </svg>
        ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      `;
      copyAllButton.addEventListener('click', () => {
        copyAllData(results);
      });
      searchResults.appendChild(copyAllButton);

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
      const tableContainer = document.createElement('div');
      tableContainer.className = 'table-responsive';
      tableContainer.setAttribute('data-aos', 'fade-up');

      let tableHTML = `
        <table class="table table-hover table-bordered">
          <thead class="table-primary">
            <tr>
              <th style="width: 5%;" class="text-center">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
              <th style="width: 10%;" class="text-center">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô</th>
              <th style="width: 20%;" class="text-center">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</th>
              <th style="width: 10%;" class="text-center">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</th>
              <th style="width: 15%;" class="text-center">‡∏ä‡∏∑‡πà‡∏≠</th>
              <th style="width: 15%;" class="text-center">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
              <th style="width: 10%;" class="text-center">‡πÄ‡∏û‡∏®</th>
              <th style="width: 5%;" class="text-center">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</th>
            </tr>
          </thead>
          <tbody>
      `;

      // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      results.forEach((record, index) => {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å record
        const ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ = record['‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || record['proportion'] || record['‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || (index + 1);
        const ‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô = record['‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô'] || record['houseNumber'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        const ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô = record['‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô'] || record['id'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        const ‡∏ä‡∏∑‡πà‡∏≠ = record['‡∏ä‡∏∑‡πà‡∏≠'] || record['name'] || '';
        const namaskul = record['namaskul'] || record['‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || '';
        const ‡πÄ‡∏û‡∏® = record['‡πÄ‡∏û‡∏®'] || record['gender'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        const recordKey = record.key || index;

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®
        let ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '-';
        if (‡πÄ‡∏û‡∏® === '‡∏´‡∏ç‡∏¥‡∏á') {
          ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß';
        } else if (‡πÄ‡∏û‡∏® === '‡∏ä‡∏≤‡∏¢') {
          ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '‡∏ô‡∏≤‡∏¢';
        }

        tableHTML += `
          <tr id="row-${recordKey}">
            <td class="text-center">${‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£}</td>
            <td class="text-center">${‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô}</td>
            <td>${‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô}</td>
            <td class="text-center">${‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤}</td>
            <td>${‡∏ä‡∏∑‡πà‡∏≠}</td>
            <td>${namaskul}</td>
            <td class="text-center">${‡πÄ‡∏û‡∏®}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-primary copy-row-btn" data-index="${index}" data-record-key="${recordKey}" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
                  <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                  <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                </svg>
              </button>
            </td>
          </tr>
        `;
      });

      tableHTML += `
          </tbody>
        </table>
      `;

      tableContainer.innerHTML = tableHTML;
      searchResults.appendChild(tableContainer);

      // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß
      setTimeout(() => {
        document.querySelectorAll('.copy-row-btn').forEach(button => {
          button.addEventListener('click', function () {
            const index = this.getAttribute('data-index');
            const recordKey = this.getAttribute('data-record-key');
            copyRowData(results[index], index, recordKey);
          });
        });
      }, 100);

      // ‡πÄ‡∏£‡∏¥‡πà‡∏° AOS animation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏´‡∏°‡πà
      AOS.refresh();
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    function copyRowData(record, index, recordKey) {
      // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å record
      const ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ = record['‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || record['proportion'] || record['‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || (parseInt(index) + 1);
      const ‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô = record['‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô'] || record['houseNumber'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
      const ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô = record['‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô'] || record['id'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
      const ‡∏ä‡∏∑‡πà‡∏≠ = record['‡∏ä‡∏∑‡πà‡∏≠'] || record['name'] || '';
      const namaskul = record['namaskul'] || record['‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || '';
      const ‡πÄ‡∏û‡∏® = record['‡πÄ‡∏û‡∏®'] || record['gender'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

      // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®
      let ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '-';
      if (‡πÄ‡∏û‡∏® === '‡∏´‡∏ç‡∏¥‡∏á') {
        ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß';
      } else if (‡πÄ‡∏û‡∏® === '‡∏ä‡∏≤‡∏¢') {
        ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '‡∏ô‡∏≤‡∏¢';
      }

      // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
      const dataToCopy = `‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£}
‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô: ${‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô}
‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô: ${‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô}
‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤: ${‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤}
‡∏ä‡∏∑‡πà‡∏≠: ${‡∏ä‡∏∑‡πà‡∏≠}
‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: ${namaskul}
‡πÄ‡∏û‡∏®: ${‡πÄ‡∏û‡∏®}`;

      // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î
      navigator.clipboard.writeText(dataToCopy)
        .then(() => {
          // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
          const rowElement = document.getElementById(`row-${recordKey}`);
          if (rowElement) {
            const originalColor = rowElement.style.backgroundColor;
            rowElement.style.backgroundColor = '#d4edda';

            setTimeout(() => {
              rowElement.style.backgroundColor = originalColor;
            }, 1000);
          }

          Swal.fire({
            icon: 'success',
            title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
            text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß',
            timer: 1500,
            showConfirmButton: false
          });
        })
        .catch(err => {
          console.error('Failed to copy: ', err);
          Swal.fire({
            icon: 'error',
            title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
          });
        });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    function copyAllData(results) {
      if (!results || results.length === 0) {
        Swal.fire({
          icon: 'warning',
          title: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å',
          text: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å',
        });
        return;
      }

      // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      let allData = `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ${results.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n`;
      allData += '='.repeat(50) + '\n\n';

      results.forEach((record, index) => {
        const ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ = record['‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || record['proportion'] || record['‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'] || (index + 1);
        const ‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô = record['‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô'] || record['houseNumber'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        const ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô = record['‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô'] || record['id'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        const ‡∏ä‡∏∑‡πà‡∏≠ = record['‡∏ä‡∏∑‡πà‡∏≠'] || record['name'] || '';
        const namaskul = record['namaskul'] || record['‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || '';
        const ‡πÄ‡∏û‡∏® = record['‡πÄ‡∏û‡∏®'] || record['gender'] || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏û‡∏®
        let ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '-';
        if (‡πÄ‡∏û‡∏® === '‡∏´‡∏ç‡∏¥‡∏á') {
          ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß';
        } else if (‡πÄ‡∏û‡∏® === '‡∏ä‡∏≤‡∏¢') {
          ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ = '‡∏ô‡∏≤‡∏¢';
        }

        allData += `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${index + 1}:\n`;
        allData += `  ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£}\n`;
        allData += `  ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô: ${‡πÄ‡∏•‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ö‡πâ‡∏≤‡∏ô}\n`;
        allData += `  ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô: ${‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô}\n`;
        allData += `  ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤: ${‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤}\n`;
        allData += `  ‡∏ä‡∏∑‡πà‡∏≠: ${‡∏ä‡∏∑‡πà‡∏≠}\n`;
        allData += `  ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: ${namaskul}\n`;
        allData += `  ‡πÄ‡∏û‡∏®: ${‡πÄ‡∏û‡∏®}\n`;
        allData += '-'.repeat(40) + '\n';
      });

      // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î
      navigator.clipboard.writeText(allData)
        .then(() => {
          // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
          Swal.fire({
            icon: 'success',
            title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
            html: `<div class="text-start">
              <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${results.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß</p>
              <p class="small text-muted">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÑ‡∏î‡πâ</p>
            </div>`,
            timer: 2000,
            showConfirmButton: false
          });
        })
        .catch(err => {
          console.error('Failed to copy: ', err);
          Swal.fire({
            icon: 'error',
            title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Ctrl+C',
          });
        });
    }
  </script>
</body>

</html>



